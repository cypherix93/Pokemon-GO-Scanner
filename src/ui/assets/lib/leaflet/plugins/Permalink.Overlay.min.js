L.Control.Permalink.include({initialize_overlay:function(){this.on("update",this._set_overlays,this),this.on("add",this._onadd_overlay,this)},_onadd_overlay:function(){this._map.on("overlayadd",this._update_overlay,this),this._map.on("overlayremove",this._update_overlay,this),this._update_overlay()},_update_overlay:function(){if(this.options.layers){var a=this.options.layers.overlayFlags();a&&""!==a&&this._update({overlays:a})}},_set_overlays:function(a){var e=a.params;this.options.layers&&e.overlays&&this.options.layers.setOverlays(e.overlays)}}),L.Control.Layers.include({setOverlays:function(a){var e,r=0;for(var s in this._layers)if(this._layers.hasOwnProperty(s)&&(e=this._layers[s],e.overlay)){var t=r>=a.length||"T"===a[r];r++,!t&&this._map.hasLayer(e.layer)?this._map.removeLayer(e.layer):t&&!this._map.hasLayer(e.layer)&&this._map.addLayer(e.layer)}},overlayFlags:function(){var a="";for(var e in this._layers)if(this._layers.hasOwnProperty(e)){var r=this._layers[e];r.overlay&&r.overlay&&(a+=this._map.hasLayer(r.layer)?"T":"F")}return a}});